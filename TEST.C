#include<reg517.h>#include<string.h>#define stop		while(1);#define frequenz	F0/*Das Programm steuert eine LED Matrix bestehend aus 16*16 LED'sP1	Bit 0 Clock x Richtung l	Bit 1 Reset x Richtung l	Bit 2 Clock x Richtung h	Bit 3 Reset x Richtung h	Bit 6 LED low aktiv	Bit 7 h=normalbetrieb l=lade ProgrammP4P5*/char hoch(char exp)	{	char res=1;	for(;exp>0;exp--)		{ 		res=res*2;  		}  	return(res);  	}//Funktionsprototypenvoid inittimer2(void);xdata char lengh _at_ 0x3200;xdata char programm[3000] _at_ 0x100;int pos=0, synch=1;void main(void)	{	int i;	P1=0xBA;	//Reset 1 Clock 0	if(P1&0x80)		{	//normalbetrieb 		while(1)  			{  	  		inittimer2();  	 		while(1)  	  			{				pos=0;				while(pos<lengh)  	  	  			{					EAL=1;					for(i=500;i>0;i--);					EAL=0;					pos++;  	  	  	      }  	  	 		}  	 		} 		}  	else   		{	//testmodus		while(1) 			{  			EAL=0;  	 		for(i=0;i<32;i++)				programm[i]=0;         programm[P7/8]=hoch(P7%8);  	 		EAL=1;  			}  		}	}//*****************Funktionen************************	void timer2(void) interrupt 5	{	P4=0;	P5=0;	synch++;	if(synch>15)		synch=0;	if(synch<8)  	  	P1=0xF9;	else  	  	P1=0xF6;	P4=programm[(pos*32)+(synch*2)];	P5=programm[(pos*32)+(synch*2)+1];	//P5=programm[pos*32+synch+16];	P1=P1&0xFA;	}	void inittimer2(void)	{	CRCL=0;   		//Timer initialisieren	CRCL=frequenz;	T2CON=0x11;	TF2=0;			//Interrupt T2 erlauben	EAL=1;	ET2=1;	}