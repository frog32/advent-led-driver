#include<reg517.h>#include<string.h>#define stop		while(1);#define frequenz	F0/*Das Programm steuert eine LED Matrix bestehend aus 16*16 LED'sP1	Bit 0 Clock x Richtung l	Bit 1 Reset x Richtung l	Bit 2 Clock x Richtung h	Bit 3 Reset x Richtung h	Bit 6 LED low aktiv	Bit 7 h=normalbetrieb l=lade ProgrammP4P5*///Funktionsprototypenvoid inittimer2(void);void initcom1(void);void send(char);char receive(void);xdata char lengh _at_ 0x3200;xdata char programm[3000] _at_ 0x100;int pos=0, synch=1;void main(void)	{	int i;	P1=0xBA;	//Reset 1 Clock 0	if(P1&0x80)		{	//normalbetrieb 		while(1)  			{  	  		inittimer2();  	 		while(1)  	  			{				pos=0;				while(pos<lengh)  	  	  			{					EAL=1;					for(i=500;i>0;i--);					EAL=0;					pos++;  	  	  	      }  	  	 		}  	 		} 		}  	/*else   		{	//lade Programm  		initcom1();  	 	send('\n');  	 	send('#');  	 	while(!(S1CON&0x01));  	 	lengh=receive();		send(lengh);  		for(pos=0;pos<lengh;pos++)  			{  			for(synch=0;synch<16;synch++)  	 			{				while(!(S1CON&0x01));  				programm[16*pos+synch]=receive();  				send(programm[16*pos+synch]);  	  			}  	 		}  		}*/	}//*****************Funktionen************************	void timer2(void) interrupt 5	{	P4=0;	P5=0;	synch++;	if(synch>15)		synch=0;	if(synch<8)  	  	P1=0xF9;	else  	  	P1=0xF6;	P4=programm[(pos*32)+(synch*2)];	P5=programm[(pos*32)+(synch*2)+1];	//P5=programm[pos*32+synch+16];	P1=P1&0xFA;	}void initcom1(void)	{	S1CON=0x90;	S1REL=217;	}void send(char ch)	{	S1BUF=ch;	while(!(S1CON&0x02));	S1CON=S1CON&0xFD;	}	char receive(void)	{	char ch=S1BUF;	S1CON=S1CON&0xFE;	return(ch);	}	void inittimer2(void)	{	CRCL=0;   		//Timer initialisieren	CRCL=frequenz;	T2CON=0x11;	TF2=0;			//Interrupt T2 erlauben	EAL=1;	ET2=1;	}